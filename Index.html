<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro Scientific Calculator</title>

<style>
:root {
  --bg:#0E0F1A; --panel:#1B1C2A; --display:#2C2F45;
  --muted:#9AA3B2; --accent:#6366F1;
  --orange:#F97316; --teal:#0D9488; --danger:#DC2626;
  --glass:rgba(255,255,255,.03);
}

[data-theme="light"]{
  --bg:#F3F4F6; --panel:#FFF; --display:#F8FAFC;
  --muted:#4B5563; --accent:#4F46E5;
  --orange:#EA580C; --teal:#059669; --danger:#B91C1C;
  --glass:rgba(0,0,0,.04);
}

body{
  margin:0; min-height:100vh;
  display:flex; justify-content:center; align-items:center;
  background:var(--bg); font-family:system-ui, sans-serif;
}

.calc-wrap{width:420px; max-width:95%}
.panel{
  background:var(--panel); padding:20px;
  border-radius:14px;
  box-shadow:0 20px 50px rgba(0,0,0,.35);
}

.topbar{
  display:flex; justify-content:space-between; margin-bottom:10px;
}
.btn-ui{
  padding:6px 12px; font-size:12px;
  background:var(--glass); color:var(--muted);
  border:1px solid var(--glass); border-radius:8px;
  cursor:pointer;
}

.display-area{
  background:var(--display);
  border-radius:12px;
  padding:15px;
  margin-bottom:10px;
}
.display{
  font-size:26px; color:#fff;
  text-align:right; min-height:32px;
  word-wrap: break-word;
}
[data-theme="light"] .display{color:#111}

.angle{
  text-align:right; font-size:12px;
  color:var(--muted);
}

.history{
  font-size:12px; color:var(--muted);
  text-align:right; min-height:16px;
  margin-top:4px;
}

.tabs{
  display:flex; gap:5px;
  background:var(--glass);
  padding:4px; border-radius:10px;
  margin:12px 0;
}
.tab{
  flex:1; text-align:center;
  padding:8px; cursor:pointer;
  border-radius:8px; color:var(--muted);
}
.tab.active{
  background:var(--panel);
  color:var(--accent);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.keys{
  display:grid; gap:8px;
  grid-template-columns:repeat(5,1fr);
}
.key{
  padding:15px 5px;
  background:#2E3340; color:#fff;
  border:none; border-radius:10px;
  font-size:16px; cursor:pointer;
  transition:transform .08s, filter .15s;
}
.key:active{transform:scale(.92); filter:brightness(1.2)}
.key.operator{background:var(--orange)}
.key.function{background:var(--accent)}
.key.equals{background:var(--teal); grid-column:span 2}
.key.back{background:var(--danger)}
.hidden{display:none}
.error{color:var(--danger) !important}
</style>
</head>

<body data-theme="dark">

<div class="calc-wrap">
<div class="panel">

<div class="topbar">
  <button id="modeBtn" class="btn-ui">DEG</button>
  <button id="themeBtn" class="btn-ui">Light Mode</button>
</div>

<div class="display-area">
  <div id="display" class="display">0</div>
  <div class="angle" id="angle">DEG</div>
  <div class="history" id="history"></div>
</div>

<div class="tabs">
  <div class="tab active" data-tab="basic">Basic</div>
  <div class="tab" data-tab="sci">Scientific</div>
</div>

<div id="basic" class="keys">
  <button class="key function">AC</button>
  <button class="key function">(</button>
  <button class="key function">)</button>
  <button class="key function">!</button>
  <button class="key operator">^</button>

  <button class="key">7</button>
  <button class="key">8</button>
  <button class="key">9</button>
  <button class="key operator">×</button>
  <button class="key operator">÷</button>

  <button class="key">4</button>
  <button class="key">5</button>
  <button class="key">6</button>
  <button class="key operator">−</button>
  <button class="key operator">+</button>

  <button class="key">1</button>
  <button class="key">2</button>
  <button class="key">3</button>
  <button class="key">.</button>
  <button class="key back">←</button>

  <button class="key">0</button>
  <button class="key equals">=</button>
</div>

<div id="sci" class="keys hidden">
  <button class="key function">AC</button>
  <button class="key function">π</button>
  <button class="key function">e</button>
  <button class="key function">sin</button>
  <button class="key function">cos</button>

  <button class="key function">tan</button>
  <button class="key function">asin</button>
  <button class="key function">acos</button>
  <button class="key function">atan</button>
  <button class="key back">←</button>

  <button class="key equals" style="grid-column:span 5">=</button>
</div>

</div>
</div>

<script>
const display = document.getElementById('display');
const historyEl = document.getElementById('history');
const modeBtn = document.getElementById('modeBtn');
const themeBtn = document.getElementById('themeBtn');
const basicKeys = document.getElementById('basic');
const sciKeys = document.getElementById('sci');

let input = '0', lastAnswer = '', error = false;
let degree = true;

// Math Helper Object
const M = {
  sin: x => degree ? Math.sin(x * Math.PI / 180) : Math.sin(x),
  cos: x => degree ? Math.cos(x * Math.PI / 180) : Math.cos(x),
  tan: x => degree ? Math.tan(x * Math.PI / 180) : Math.tan(x),
  asin: x => degree ? Math.asin(x) * 180 / Math.PI : Math.asin(x),
  acos: x => degree ? Math.acos(x) * 180 / Math.PI : Math.acos(x),
  atan: x => degree ? Math.atan(x) * 180 / Math.PI : Math.atan(x),
  pi: Math.PI, 
  e: Math.E,
  factorial: n => {
    if (n < 0 || !Number.isInteger(n)) return NaN;
    let r = 1; for (let i = 2; i <= n; i++) r *= i; return r;
  }
};

function update() {
  display.textContent = input;
  display.classList.toggle('error', error);
}

function press(v) {
  if (error) { input = ''; error = false; }
  
  // If user starts typing after a calculation, clear result
  if (lastAnswer !== '' && !isNaN(v)) {
    input = v;
    lastAnswer = '';
  } else {
    if (input === '0' && v !== '.') input = '';
    input += v;
  }
  update();
}

function back() {
  if (error) { clearAll(); return; }
  input = input.length > 1 ? input.slice(0, -1) : '0';
  update();
}

function clearAll() {
  input = '0';
  lastAnswer = '';
  error = false;
  historyEl.textContent = '';
  update();
}

function compute() {
  try {
    let expr = input
      .replace(/π/g, 'pi')
      .replace(/×/g, '*')
      .replace(/÷/g, '/')
      .replace(/−/g, '-')
      .replace(/\^/g, '**')
      // Factorial handling: finds numbers or bracketed expressions followed by !
      .replace(/(\d+(\.\d+)?|\((?:[^()]+|\([^()]*\))*\))!/g, 'factorial($1)');

    // Map math functions to M object
    const fnNames = Object.keys(M);
    const fn = new Function(...fnNames, `return ${expr}`);
    const res = fn(...Object.values(M));

    if (isNaN(res) || !isFinite(res)) throw new Error();

    historyEl.textContent = `${input} =`;
    input = String(Number(res.toFixed(10)));
    lastAnswer = input;
  } catch (e) {
    input = 'Error';
    error = true;
  }
  update();
}

// Global Click Listener
document.addEventListener('click', e => {
  if (!e.target.classList.contains('key')) return;
  const v = e.target.textContent;

  if (v === 'AC') clearAll();
  else if (v === '←') back();
  else if (v === '=') compute();
  else if (['sin', 'cos', 'tan', 'asin', 'acos', 'atan'].includes(v)) press(v + '(');
  else press(v);
});

// Tab Switching
document.querySelectorAll('.tab').forEach(t => {
  t.onclick = () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    const isBasic = t.dataset.tab === 'basic';
    basicKeys.classList.toggle('hidden', !isBasic);
    sciKeys.classList.toggle('hidden', isBasic);
  };
});

// Toggle Degree/Radian
modeBtn.onclick = () => {
  degree = !degree;
  const label = degree ? 'DEG' : 'RAD';
  angle.textContent = label;
  modeBtn.textContent = label;
};

// Toggle Dark/Light Theme
themeBtn.onclick = () => {
  const isLight = document.body.dataset.theme === 'light';
  document.body.dataset.theme = isLight ? 'dark' : 'light';
  themeBtn.textContent = isLight ? 'Light Mode' : 'Dark Mode';
};
</script>
</body>
</html>
